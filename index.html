<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no" />
  <title>WHO VQ — Start</title>

  <!-- 背景画像の先読み（必ず public/items/bg/*.jpg ） -->
  <link rel="preload" as="image" href="public/items/bg/sunrise.jpg" />
  <link rel="preload" as="image" href="public/items/bg/beach_day.jpg" />
  <link rel="preload" as="image" href="public/items/bg/night_beach.jpg" />

  <style>
    :root {
      --glass: rgba(255,255,255,.12);
      --glass-strong: rgba(255,255,255,.18);
      --text-shadow: 0 2px 8px rgba(0,0,0,.55);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{
      font-family:system-ui,"Noto Sans JP","Hiragino Sans","Meiryo",sans-serif;
      color:#fff; background:#000 center/cover no-repeat fixed; overflow:hidden;
    }
    /* 画面全体のコンテナ */
    #wrap{position:relative; inset:0; width:100%; height:100dvh;}
    /* 上バー（言語・背景ラベル） */
    #topbar{
      position:fixed; left:0; right:0; top:0; z-index:10;
      display:flex; align-items:center; justify-content:space-between;
      padding:10px 12px;
      background:linear-gradient(180deg,rgba(0,0,0,.55),rgba(0,0,0,0));
    }
    #bgLabel{
      font-size:12px; opacity:.9; padding:6px 10px; border-radius:10px;
      background:rgba(0,0,0,.35); box-shadow:var(--text-shadow);
    }
    /* 言語セレクタ */
    #langBox{
      display:flex; align-items:center; gap:6px;
      padding:6px 10px; border-radius:999px; background:var(--glass);
      backdrop-filter: blur(6px);
    }
    #langSelect{
      appearance:none; background:transparent; color:#fff; border:none; font-weight:600; cursor:pointer;
    }
    #langSelect:focus{ outline:2px solid rgba(255,255,255,.4); border-radius:6px; }

    /* 中央のタイトル */
    main{
      position:absolute; inset:0; display:grid; place-items:center;
      padding:24px;
    }
    .center{
      text-align:center; max-width:min(90vw, 980px);
      text-shadow:var(--text-shadow);
    }
    h1{ font-size: clamp(28px, 5vw, 56px); margin:0 0 14px }
    p.lead{ font-size: clamp(14px, 2.2vw, 20px); margin:0 0 28px; opacity:.92 }

    /* ボタン群 */
    .btns{ display:flex; gap:14px; justify-content:center; flex-wrap:wrap }
    a.btn, button.btn{
      display:inline-flex; align-items:center; justify-content:center;
      padding:10px 18px; border-radius:14px; border:none; cursor:pointer;
      background:var(--glass); color:#fff; font-weight:700; text-decoration:none;
      backdrop-filter: blur(6px); transition:transform .02s ease, background .2s ease;
      min-width:140px;
    }
    a.btn.primary, button.btn.primary{ background:#74c1e6cc }
    .btn:active{ transform:translateY(1px) }
    .btn:hover{ background:var(--glass-strong) }
    .btn.primary:hover{ filter:brightness(1.05) }

    /* 画面下のコピー */
    footer{
      position:fixed; left:50%; bottom:10px; transform:translateX(-50%);
      font-size:12px; opacity:.88; background:rgba(0,0,0,.35);
      padding:6px 10px; border-radius:10px; backdrop-filter: blur(6px);
      text-shadow:var(--text-shadow);
    }
  </style>
</head>
<body>
  <div id="wrap" aria-label="start screen">
    <div id="topbar">
      <div id="bgLabel" data-i18n="bg.day">Day</div>
      <div id="langBox" aria-label="language">
        <span>🌐</span>
        <select id="langSelect" title="language">
          <option value="ja">日本語</option>
          <option value="en">English</option>
          <option value="zh">中文</option>
          <option value="ko">한국어</option>
        </select>
      </div>
    </div>

    <main>
      <div class="center">
        <h1 data-i18n="title">WHO VQ</h1>
        <p class="lead" data-i18n="subtitle">あなたのお世話が、誰かの世界に</p>
        <div class="btns">
          <a id="startBtn" class="btn primary" href="char.html" data-i18n="start">スタート</a>
          <button id="resumeBtn" class="btn" data-i18n="resume">続きから</button>
          <a class="btn" href="about.html" data-i18n="about">研究について</a>
        </div>
      </div>
    </main>

    <footer id="phaseFoot" data-i18n="phase">背景：昼</footer>
  </div>

  <script>
    // ========= 背景（時刻で自動）＆フェーズ名 =========
    function setBackgroundAndLabel(){
      const h = new Date().getHours();
      let phase = "day", bg = "public/items/bg/beach_day.jpg";
      if (h >= 5 && h <= 8){ phase = "sunrise"; bg = "public/items/bg/sunrise.jpg"; }
      else if (h >= 18 || h <= 4){ phase = "night"; bg = "public/items/bg/night_beach.jpg"; }
      document.body.style.backgroundImage = `url('${bg}')`;
      document.body.dataset.phase = phase;
      // 翻訳更新時にラベルを再設定するため、ここでは data-phase をだけ
    }

    // ========= i18n テーブル =========
    const I18N = {
      ja:{
        title:"WHO VQ",
        subtitle:"あなたのお世話が、誰かの世界に",
        start:"スタート",
        resume:"続きから",
        about:"研究について",
        phase:"背景：{label}",
        bg:{ sunrise:"朝日", day:"昼", night:"夜" }
      },
      en:{
        title:"WHO VQ",
        subtitle:"Your care can shape someone’s world.",
        start:"Start",
        resume:"Continue",
        about:"About",
        phase:"Background: {label}",
        bg:{ sunrise:"Sunrise", day:"Day", night:"Night" }
      },
      zh:{
        title:"WHO VQ",
        subtitle:"你的关怀，连接着他人的世界。",
        start:"开始",
        resume:"继续",
        about:"关于研究",
        phase:"背景：{label}",
        bg:{ sunrise:"日出", day:"白天", night:"夜晚" }
      },
      ko:{
        title:"WHO VQ",
        subtitle:"당신의 돌봄이 누군가의 세계를 만듭니다.",
        start:"시작",
        resume:"이어하기",
        about:"연구 소개",
        phase:"배경: {label}",
        bg:{ sunrise:"새벽", day:"낮", night:"밤" }
      }
    };

    function getLang(){
      return localStorage.getItem("whoai_lang") || navigator.language.slice(0,2) || "ja";
    }
    function setLang(lang){
      localStorage.setItem("whoai_lang", lang);
      document.documentElement.setAttribute("lang", lang);
    }
    function applyI18n(){
      const lang = (getLang() in I18N) ? getLang() : "ja";
      const dict = I18N[lang];
      // テキスト置換
      document.querySelectorAll("[data-i18n]").forEach(el=>{
        const key = el.getAttribute("data-i18n");
        const value = key.split(".").reduce((o,k)=> o && o[k], dict);
        if (typeof value === "string"){ el.textContent = value; }
      });
      // 背景ラベル（フェーズ）
      const phase = document.body.dataset.phase || "day";
      const label = (dict.bg && dict.bg[phase]) ? dict.bg[phase] : phase;
      const foot = document.getElementById("phaseFoot");
      const bgLabel = document.getElementById("bgLabel");
      foot.textContent = (dict.phase || "背景：{label}").replace("{label}", label);
      bgLabel.textContent = label;
      // セレクタ表示言語
      const sel = document.getElementById("langSelect");
      sel.value = lang;
    }

    // ========= 続きから（最後に開いたページ） =========
    function goResume(){
      const last = localStorage.getItem("whoai_lastPage");
      const allow = new Set(["index.html","char.html","asari.html","collection.html","accessory.html","night.html","about.html"]);
      const target = (last && allow.has(new URL(last, location.href).pathname.split("/").pop())) ? last : "char.html";
      location.href = target;
    }

    // ========= 初期化 =========
    setBackgroundAndLabel();
    setLang(getLang());
    applyI18n();
    // 言語セレクタ
    document.getElementById("langSelect").addEventListener("change", (e)=>{
      setLang(e.target.value); applyI18n();
    });
    // ボタン
    document.getElementById("resumeBtn").addEventListener("click", goResume);

    // 現在ページを保存（次回の「続きから」用）
    localStorage.setItem("whoai_lastPage", "index.html");
  </script>
</body>
</html>
