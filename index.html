<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no" />
<title>WHO VQ</title>
<style>
  html,body{margin:0;height:100%;overflow:hidden;background:#000;color:#fff;font-family:system-ui,"Noto Sans JP",sans-serif}
  .bg{position:fixed;inset:0;background-size:cover;background-position:center;opacity:0;transition:opacity .7s;pointer-events:none;z-index:0}
  .bg.show{opacity:1}
  #topbar{position:fixed;left:0;right:0;top:0;z-index:10;display:flex;justify-content:space-between;align-items:center;padding:8px 10px;background:linear-gradient(180deg,rgba(0,0,0,.55),rgba(0,0,0,0))}
  #topbar button{padding:6px 10px;border:none;border-radius:10px;background:rgba(255,255,255,.92);color:#111;cursor:pointer}
  #hero{position:fixed;inset:0;z-index:5;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:18px;text-align:center;background:rgba(0,0,0,.15)}
  #hero h1{font-size:clamp(20px,4vw,36px);margin:0 16px}
  .heroBtns{display:flex;gap:12px}
  .heroBtns button{padding:12px 18px;border:none;border-radius:12px;cursor:pointer;font-weight:700}
</style>
</head>
<body>
  <!-- 背景 -->
  <div id="bg-sunrise" class="bg show" style="background-image:url('/WHO-VQ/public/items/bg/sunrise.jpg')"></div>
  <div id="bg-beach"   class="bg"        style="background-image:url('/WHO-VQ/public/items/bg/beach_day.jpg')"></div>
  <div id="bg-night"   class="bg"        style="background-image:url('/WHO-VQ/public/items/bg/night_beach.jpg')"></div>

  <!-- Topbar -->
  <div id="topbar">
    <div><button id="btnAbout">研究について</button></div>
    <div><button id="btnLang">EN</button></div>
  </div>

  <!-- Hero -->
  <div id="hero">
    <h1 id="heroTitle">朝日の海へようこそ</h1>
    <div class="heroBtns">
      <button id="btnHeroStart">スタート</button>
      <button id="btnHeroContinue">続きから</button>
    </div>
  </div>

  <!-- 共通JS -->
  <script src="/WHO-VQ/web/talk.js"></script>
  <script>
    // 背景初期
    function scene(name){
      document.querySelectorAll('.bg').forEach(e=>e.classList.remove('show'));
      const el=document.getElementById('bg-'+name);
      if(el) el.classList.add('show');
    }
    scene('sunrise');

    // 多言語
    const btnStart=document.getElementById('btnHeroStart');
    const btnCont =document.getElementById('btnHeroContinue');
    const btnAbout=document.getElementById('btnAbout');
    const btnLang =document.getElementById('btnLang');

    function applyLang(){
      const lang=window.getLang();
      const L=window.setLang(lang);
      document.getElementById('heroTitle').textContent=L.hero;
      btnStart.textContent=L.start;
      btnCont.textContent=L.cont;
      btnAbout.textContent=L.about;
      // 次に切り替わる言語
      btnLang.textContent = window.nextLangLabel(lang);
      btnLang.title = `言語を${btnLang.textContent}に切り替え`;
    }
    btnLang.addEventListener('click',()=>{
      const lang=window.getLang();
      const order=["ja","en","zh","ko"];
      const next=order[(order.indexOf(lang)+1)%order.length];
      window.setLang(next);
      applyLang();
    });
    applyLang();

    // 続きから活性
    const hasSave = !!window.store.rawGet('whoai.char');
    btnCont.disabled=!hasSave; btnCont.style.opacity=hasSave?'1':'.5';

    // 画面遷移
    btnStart.addEventListener('click',()=>location.href='/WHO-VQ/char.html');
    btnCont.addEventListener('click',()=>{
      const last = window.store.rawGet('whoai.lastScene') || 'beach';
      location.href = (last==='night')? '/WHO-VQ/night.html' : '/WHO-VQ/beach.html';
    });
    btnAbout.addEventListener('click',()=>location.href='/WHO-VQ/about.html');
  </script>
</body>
</html>
