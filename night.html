<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>WHO VQ - Night</title>
<style>
  html,body{margin:0;height:100%;font-family:system-ui,"Noto Sans JP",sans-serif}
  #bg{position:fixed;inset:0;background:url('./public/items/bg/night_beach.jpg') center/cover no-repeat;}
  #shade{position:fixed;inset:0;background:rgba(0,0,0,.55)}
  #panel{position:fixed;inset:0;display:flex;align-items:center;justify-content:center}
  .card{background:rgba(255,255,255,.75);backdrop-filter:blur(4px);color:#111;border-radius:14px;padding:16px;width:min(92svw,640px);max-height:90vh;display:flex;flex-direction:column}
  h2{margin:0 0 8px 0}
  #chatLog{flex:1;overflow:auto;padding:10px;background:rgba(242,242,242,.4);border-radius:10px}
  .msg{margin:6px 0;padding:8px 12px;border-radius:16px;max-width:70%}
  .msg.me{background:rgba(174,225,255,.85);margin-left:auto;color:#002}
  .msg.ai{background:rgba(255,255,255,.85);margin-right:auto;color:#000}
  #ctrl{display:flex;gap:6px;margin-top:8px}
  #input{flex:1;padding:10px;border-radius:12px;border:1px solid #ccc}
  #send{padding:10px 14px;border:none;border-radius:12px;background:#4cafef;color:#fff;cursor:pointer}
</style>
</head>
<body>
  <div id="bg" aria-hidden="true"></div>
  <div id="shade" aria-hidden="true"></div>

  <div id="panel">
    <div class="card">
      <h2>夜の会話</h2>
      <div id="chatLog"></div>
      <div id="ctrl">
        <input id="input" type="text" placeholder="夜空を見ながら、何を話そう？">
        <button id="send">送信</button>
      </div>
      <div style="margin-top:8px"><a href="./index.html">← 戻る</a></div>
    </div>
  </div>

  <!-- APIクライアント -->
  <script src="./talk-client.js"></script>
  <script>
    const log = document.getElementById('chatLog');
    const input = document.getElementById('input');
    const send = document.getElementById('send');

    function add(role, text){
      const d=document.createElement('div');
      d.className='msg ' + (role==='user'?'me':'ai');
      d.textContent=text;
      log.appendChild(d);
      log.scrollTop = log.scrollHeight;
    }

    send.onclick = async ()=>{
      const text = input.value.trim();
      if(!text) return;
      add('user', text);
      input.value='';
      const { reply } = await window.talkToWhoAI(text, { personality: '元気' });
      add('ai', reply || '…');
    };
  </script>
</body>
</html>
