<!DOCTYPE html>
hudCount.textContent = collected.length;
spawnParticles(x,y,s.type.color);
shells.splice(i,1);
break;
}
}
if(shells.length===0){ spawn(24); }
});


function spawnParticles(x,y,color){
for(let i=0;i<12;i++){
particles.push({x,y,vx:(Math.random()-0.5)*2,vy:(Math.random()-0.5)*2,life:30,color});
}
}


function draw(){
ctx.clearRect(0,0,cv.width,cv.height);
// 砂のザラつき
for(let i=0;i<60;i++){
ctx.fillStyle = `rgba(255,255,255,${Math.random()*0.02})`;
ctx.fillRect(Math.random()*cv.width, Math.random()*cv.height, 2, 2);
}
// テキストガイド
if(!playing){ ctx.font='16px system-ui'; ctx.fillStyle='#fff'; ctx.fillText(getText('tap_to_collect'), 20, 30); }
// 貝
for(const s of shells){
ctx.beginPath(); ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
ctx.fillStyle=s.type.color; ctx.fill(); ctx.strokeStyle='rgba(0,0,0,.25)'; ctx.stroke();
}
// パーティクル
for(const p of particles){
ctx.globalAlpha = Math.max(p.life/30, 0);
ctx.fillStyle = p.color; ctx.beginPath(); ctx.arc(p.x,p.y,3,0,Math.PI*2); ctx.fill();
ctx.globalAlpha = 1;
}
}


function update(){
// タイマー
if(playing){
timer -= 1/60; if(timer<=0){ timer=0; end(); }
hudTime.textContent = Math.ceil(timer).toString();
}
// パーティクル更新
particles.forEach(p=>{ p.x+=p.vx; p.y+=p.vy; p.vy+=0.01; p.life--; });
particles = particles.filter(p=>p.life>0);
}


function loop(){
update(); draw();
tickHandle = requestAnimationFrame(loop);
}


// 初期描画
spawn(24); draw();
});
</script>
</body>
</html>
