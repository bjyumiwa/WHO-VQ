<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no" />
<title>Choose | WHO VQ</title>
<style>
  html,body{margin:0;height:100%;overflow:hidden;background:#000;color:#fff;font-family:system-ui,"Noto Sans JP",sans-serif}
  .bg{position:fixed;inset:0;background-size:cover;background-position:center;opacity:0;transition:opacity .7s;pointer-events:none;z-index:0}
  .bg.show{opacity:1}
  #topbar{position:fixed;left:0;right:0;top:0;z-index:10;display:flex;justify-content:space-between;align-items:center;padding:8px 10px;background:linear-gradient(180deg,rgba(0,0,0,.55),rgba(0,0,0,0))}
  #topbar button{padding:6px 10px;border:none;border-radius:10px;background:rgba(255,255,255,.92);color:#111;cursor:pointer}
  #main{position:fixed;inset:0;z-index:5;display:flex;flex-direction:column;gap:16px;align-items:center;justify-content:center;background:rgba(0,0,0,.15);padding:20px}
  #title{font-size:clamp(20px,4vw,32px);text-shadow:0 2px 8px rgba(0,0,0,.45)}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:12px;width:min(95svw,800px)}
  .choice{border:1px solid #eee;border-radius:12px;padding:8px;text-align:center;background:rgba(255,255,255,.9);color:#111;cursor:pointer}
  .choice img{width:96px;height:auto;display:block;margin:0 auto 6px}
</style>
</head>
<body>
  <div id="bg-sunrise" class="bg show" style="background-image:url('/WHO-VQ/public/items/bg/sunrise.jpg')"></div>

  <div id="topbar">
    <div><button id="btnBack">戻る</button></div>
    <div><button id="btnLang">EN</button></div>
  </div>

  <div id="main">
    <div id="title">キャラを選んでね</div>
    <div id="charGrid" class="grid"></div>
  </div>

  <script src="/WHO-VQ/web/talk.js"></script>
  <script>
    const CHAR_LIST=[
      'blue_closed.png','green_open.png','orange_closed.png','pink_closed.png','purple_closed.png',
      'tane_green.png','tane_pink.png','tane_purple.png','tane_blue.png'
    ].map(n=>`/WHO-VQ/public/assets/stage1/${n}`);

    const grid=document.getElementById('charGrid');

    function render(){
      grid.innerHTML='';
      CHAR_LIST.forEach(src=>{
        const d=document.createElement('div');
        d.className='choice';
        d.innerHTML=`<img src="${src}" alt=""><div>${src.split('/').pop().replace('.png','')}</div>`;
        d.onclick=()=>{ window.store.rawSet('whoai.char',src); window.store.rawSet('whoai.lastScene','beach'); location.href='/WHO-VQ/beach.html'; };
        grid.appendChild(d);
      });
    }
    render();

    // 多言語
    const btnBack=document.getElementById('btnBack');
    const btnLang=document.getElementById('btnLang');
    function applyLang(){
      const lang=window.getLang(); const L=window.setLang(lang);
      document.getElementById('title').textContent=L.chooseChar;
      btnBack.textContent=L.back||'Back';
      btnLang.textContent=window.nextLangLabel(lang);
      btnLang.title=`言語を${btnLang.textContent}に切り替え`;
    }
    btnLang.addEventListener('click',()=>{
      const lang=window.getLang(); const order=["ja","en","zh","ko"];
      const next=order[(order.indexOf(lang)+1)%order.length];
      window.setLang(next); applyLang();
    });
    applyLang();

    btnBack.addEventListener('click',()=>location.href='/WHO-VQ/index.html');
  </script>
</body>
</html>
