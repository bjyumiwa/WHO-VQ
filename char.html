<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no" />
  <title>WHO VQ — Character</title>

  <!-- 背景＆キャラ先読み（必ず public/ 配下） -->
  <link rel="preload" as="image" href="public/items/bg/sunrise.jpg" />
  <link rel="preload" as="image" href="public/items/bg/beach_day.jpg" />
  <link rel="preload" as="image" href="public/items/bg/night_beach.jpg" />
  <link rel="preload" as="image" href="public/assets/stage1/pink_open.png" />
  <link rel="preload" as="image" href="public/assets/stage1/blue_open.png" />
  <link rel="preload" as="image" href="public/assets/stage1/green_open.png" />
  <link rel="preload" as="image" href="public/assets/stage1/purple_open.png" />

  <style>
    :root { --glass: rgba(255,255,255,.12); --shadow: 0 10px 24px rgba(0,0,0,.35) }
    *{box-sizing:border-box} html,body{height:100%;margin:0}
    body{
      font-family:system-ui,"Noto Sans JP","Hiragino Sans","Meiryo",sans-serif;
      color:#fff; background:#000 center/cover no-repeat fixed; overflow:auto;
    }
    #topbar{position:sticky;top:0;z-index:10;display:flex;justify-content:space-between;align-items:center;gap:8px;padding:10px 12px;background:linear-gradient(180deg,rgba(0,0,0,.55),rgba(0,0,0,0))}
    .back{padding:8px 12px;border:none;border-radius:999px;background:var(--glass);color:#fff;font-weight:700;cursor:pointer;backdrop-filter: blur(6px)}
    #langBox{display:flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;background:var(--glass);backdrop-filter: blur(6px)}
    #langSelect{appearance:none;background:transparent;color:#fff;border:none;font-weight:700;cursor:pointer}
    h1{text-align:center;margin:8px 0 0;text-shadow:0 2px 8px rgba(0,0,0,.55);font-size:clamp(22px,4.5vw,40px)}
    p.lead{text-align:center;opacity:.92;margin:4px 0 18px;text-shadow:0 2px 8px rgba(0,0,0,.55)}

    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:16px;padding:16px;max-width:1200px;margin:0 auto 40px}
    .card{background:rgba(0,0,0,.28);border:1px solid rgba(255,255,255,.06);border-radius:18px;padding:16px;backdrop-filter: blur(4px);display:flex;flex-direction:column;align-items:center;gap:10px;box-shadow:var(--shadow)}
    .card img{display:block;width:min(38vw,240px);height:auto;object-fit:contain;filter:drop-shadow(0 10px 16px rgba(0,0,0,.45))}
    .name{font-weight:800;text-align:center}
    .cap{font-size:12px;opacity:.88}
    .pick{margin-top:6px;padding:10px 14px;border:none;border-radius:12px;background:#74c1e6cc;color:#fff;font-weight:800;cursor:pointer}
    .pick:active{transform:translateY(1px)}
    footer{position:sticky;bottom:0;width:fit-content;margin:0 auto 12px;font-size:12px;opacity:.9;background:var(--glass);padding:6px 10px;border-radius:10px;backdrop-filter: blur(6px)}
  </style>
</head>
<body>
  <div id="topbar">
    <button class="back" onclick="location.href='index.html'">←</button>
    <div style="flex:1"></div>
    <div id="langBox">
      <span>🌐</span>
      <select id="langSelect" aria-label="language">
        <option value="ja">日本語</option>
        <option value="en">English</option>
        <option value="zh">中文</option>
        <option value="ko">한국어</option>
      </select>
    </div>
  </div>

  <h1 data-i18n="char.title">キャラクターを選ぶ</h1>
  <p class="lead" data-i18n="char.note">はじめの相棒を選んでください</p>

  <section class="grid" id="charGrid">
    <!-- 4種：pink / blue / green / purple -->
    <div class="card">
      <img src="public/assets/stage1/pink_open.png" alt="Mi (Pink)" loading="eager" decoding="async">
      <div class="name">Mi（ピンク）/ Mi (Pink)</div>
      <div class="cap" data-i18n="char.seed">はじめの相棒</div>
      <button class="pick" data-path="public/assets/stage1/pink_open.png" data-i18n="char.choose">この子にする</button>
    </div>
    <div class="card">
      <img src="public/assets/stage1/blue_open.png" alt="Be (Blue)" loading="eager" decoding="async">
      <div class="name">Be（ブルー）/ Be (Blue)</div>
      <div class="cap" data-i18n="char.seed">はじめの相棒</div>
      <button class="pick" data-path="public/assets/stage1/blue_open.png" data-i18n="char.choose">この子にする</button>
    </div>
    <div class="card">
      <img src="public/assets/stage1/green_open.png" alt="Co (Green)" loading="eager" decoding="async">
      <div class="name">Co（グリーン）/ Co (Green)</div>
      <div class="cap" data-i18n="char.seed">はじめの相棒</div>
      <button class="pick" data-path="public/assets/stage1/green_open.png" data-i18n="char.choose">この子にする</button>
    </div>
    <div class="card">
      <img src="public/assets/stage1/purple_open.png" alt="Su (Purple)" loading="eager" decoding="async">
      <div class="name">Su（パープル）/ Su (Purple)</div>
      <div class="cap" data-i18n="char.seed">はじめの相棒</div>
      <button class="pick" data-path="public/assets/stage1/purple_open.png" data-i18n="char.choose">この子にする</button>
    </div>
  </section>

  <footer data-i18n="char.tip">クリック／タップで選択 → 潮干狩りへ進みます</footer>

  <script>
    // 背景（時刻で切替）
    (function setBg(){
      const h = new Date().getHours();
      let bg = "public/items/bg/beach_day.jpg";
      if (h >= 5 && h <= 8) bg = "public/items/bg/sunrise.jpg";
      else if (h >= 18 || h <= 4) bg = "public/items/bg/night_beach.jpg";
      document.body.style.backgroundImage = `url('${bg}')`;
    })();

    // i18n
    const I18N = {
      ja:{ char:{ title:"キャラクターを選ぶ", note:"はじめの相棒を選んでください", seed:"はじめの相棒", choose:"この子にする", tip:"クリック／タップで選択 → 潮干狩りへ進みます" } },
      en:{ char:{ title:"Choose Your Character", note:"Pick your first companion.",     seed:"First companion", choose:"Choose", tip:"Tap to choose → Go to clamming" } },
      zh:{ char:{ title:"选择角色",              note:"请选择你的第一位伙伴。",          seed:"最初的伙伴",    choose:"就选TA",   tip:"点击选择 → 进入潮间带挖贝" } },
      ko:{ char:{ title:"캐릭터 선택",           note:"첫 번째 동반자를 선택하세요.",     seed:"첫 동반자",     choose:"선택",     tip:"탭하여 선택 → 조개잡이로 이동" } }
    };
    function getLang(){ return localStorage.getItem("whoai_lang") || navigator.language.slice(0,2) || "ja"; }
    function setLang(lang){ localStorage.setItem("whoai_lang", lang); document.documentElement.setAttribute("lang", lang); }
    function applyI18n(){
      const lang = (getLang() in I18N) ? getLang() : "ja";
      const dict = I18N[lang];
      document.querySelectorAll("[data-i18n]").forEach(el=>{
        const key = el.getAttribute("data-i18n");
        const value = key.split(".").reduce((o,k)=> o && o[k], dict);
        if (typeof value === "string") el.textContent = value;
      });
      document.getElementById("langSelect").value = lang;
    }
    setLang(getLang()); applyI18n();
    document.getElementById("langSelect").addEventListener("change", e=>{ setLang(e.target.value); applyI18n(); });

    // 選択 → 保存 → asari.html へ（確実に遷移）
    function goAsari(){
      // デプロイ先のサブパスでも壊れないように、相対で明示
      const target = new URL("asari.html", location.href).href;
      window.location.assign(target);
    }
    function selectChar(path){
      localStorage.setItem("whoai_character_src", path);
      localStorage.setItem("whoai_lastPage", "asari.html");
      goAsari();
    }
    document.querySelectorAll(".pick").forEach(btn=>{
      btn.addEventListener("click", ()=> selectChar(btn.dataset.path));
    });

    // 「続きから」用
    localStorage.setItem("whoai_lastPage", "char.html");
  </script>
</body>
</html>
