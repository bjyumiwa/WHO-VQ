<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no" />
  <title>WHO VQ - キャラ選択</title>
  <style>
    html,body{margin:0;height:100%;background:#000;color:#fff;font-family:system-ui,"Noto Sans JP",sans-serif}
    .bg{position:fixed;inset:0;background:url('./public/bg/sunrise.jpg') center bottom / cover no-repeat;filter:brightness(.9)}
    header{position:fixed;left:0;right:0;top:0;display:flex;justify-content:space-between;gap:8px;padding:10px;z-index:10}
    header button{padding:8px 12px;border:none;border-radius:10px;background:rgba(255,255,255,.9);color:#111;cursor:pointer}
    main{position:fixed;inset:0;display:flex;flex-direction:column;justify-content:center;align-items:center;gap:14px;background:rgba(0,0,0,.35)}
    h1{margin:0 16px;text-align:center;font-size:clamp(20px,4vw,36px);text-shadow:0 2px 8px rgba(0,0,0,.5)}
    .grid{width:min(92svw,800px);display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:14px}
    .choice{background:rgba(255,255,255,.92);color:#111;border-radius:14px;padding:10px;text-align:center;cursor:pointer;transition:transform .12s}
    .choice:hover{transform:translateY(-2px)}
    .choice img{width:90px;height:auto;display:block;margin:0 auto 6px;user-select:none}
    .bar{display:flex;gap:8px;flex-wrap:wrap;justify-content:center}
    .bar button{padding:10px 14px;border:none;border-radius:12px;background:rgba(255,255,255,.92);color:#111;cursor:pointer;font-weight:700}
    .hint{opacity:.9}
  </style>
</head>
<body>
  <div class="bg"></div>

  <header>
    <button id="backBtn">← <span data-i="back">戻る</span></button>
    <button id="langBtn">EN</button>
  </header>

  <main>
    <h1 id="title">キャラを選んでね</h1>
    <div id="grid" class="grid" aria-label="characters"></div>
    <div class="bar">
      <button id="randomBtn">ランダム</button>
      <button id="continueBtn">決定</button>
    </div>
    <div class="hint" id="hint">選んだキャラは次のステージ（砂浜）で表示されます。</div>
  </main>

  <script>
    /* ===== 多言語 ===== */
    const I18N={
      ja:{back:'戻る',title:'キャラを選んでね',random:'ランダム',decide:'決定',hint:'選んだキャラは次のステージ（砂浜）で表示されます。',langNext:'EN'},
      en:{back:'Back',title:'Choose your character',random:'Random',decide:'Confirm',hint:'The chosen character will appear on the beach stage.',langNext:'中文'},
      zh:{back:'返回',title:'选择角色',random:'随机',decide:'确定',hint:'所选角色会显示在沙滩场景。',langNext:'한국어'},
      ko:{back:'뒤로',title:'캐릭터를 선택하세요',random:'랜덤',decide:'결정',hint:'선택한 캐릭터는 해변 씬에 표시됩니다.',langNext:'日本語'}
    };
    const ORDER=['ja','en','zh','ko'];
    const getLang=()=>localStorage.getItem('who_vq.lang')||'ja';
    function setLang(lang){
      const L=I18N[lang]||I18N.ja; document.documentElement.lang=lang;
      localStorage.setItem('who_vq.lang',lang);
      document.querySelector('#backBtn span[data-i="back"]').textContent=L.back;
      document.getElementById('title').textContent=L.title;
      document.getElementById('randomBtn').textContent=L.random;
      document.getElementById('continueBtn').textContent=L.decide;
      document.getElementById('hint').textContent=L.hint;
      const next=ORDER[(ORDER.indexOf(lang)+1)%ORDER.length];
      const lb=document.getElementById('langBtn'); lb.textContent=I18N[lang].langNext; lb.dataset.next=next;
    }
    document.getElementById('langBtn').onclick=()=>setLang(document.getElementById('langBtn').dataset.next);

    /* ===== キャラ一覧 ===== */
    const CHAR_LIST=[
      'blue_closed.png','green_open.png','orange_closed.png','pink_closed.png','purple_closed.png',
      'tane_green.png','tane_pink.png','tane_purple.png','tane_blue.png'
    ].map(n=>`./public/assets/stage1/${n}`);

    const grid=document.getElementById('grid');
    let picked=null;

    function renderGrid(){
      grid.innerHTML='';
      CHAR_LIST.forEach(src=>{
        const d=document.createElement('div'); d.className='choice';
        d.innerHTML=`<img src="${src}" alt=""><div>${src.split('/').pop().replace('.png','')}</div>`;
        d.onclick=()=>{ picked=src; document.querySelectorAll('.choice').forEach(x=>x.style.outline='none'); d.style.outline='3px solid #4cafef'; };
        grid.appendChild(d);
      });
    }

    /* ===== 動作 ===== */
    document.getElementById('backBtn').onclick=()=>location.href='who_vq_start.html';
    document.getElementById('randomBtn').onclick=()=>{
      picked = CHAR_LIST[Math.floor(Math.random()*CHAR_LIST.length)];
      // 目印として最後にクリック風の枠
      const idx=CHAR_LIST.indexOf(picked);
      const node=grid.children[idx]; if(node) { node.style.outline='3px solid #4cafef'; }
    };
    document.getElementById('continueBtn').onclick=()=>{
      if(!picked){ // 未選択なら先頭を暫定
        picked=CHAR_LIST[0];
      }
      localStorage.setItem('whoai.char', JSON.stringify(picked));
      // ビーチへ
      location.href='who_vq_beach.html';
    };

    // 初期化
    renderGrid();
    setLang(getLang());
  </script>
</body>
</html>
